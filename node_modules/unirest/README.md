# Unirest for Node.js [![Build Status](https://travis-ci.org/Mashape/unirest-nodejs.png?branch=master***REMOVED***](https://travis-ci.org/Mashape/unirest-nodejs***REMOVED***

Unirest is a set of lightweight HTTP libraries available in multiple languages.

Created with love by [nijikokun](http://github.com/nijikokun***REMOVED*** @ [mashape.com](http://mashape.com***REMOVED***

## Installing

To utilize unirest for node.js install the the `npm` module:

```js
npm install unirest
```

After installing the `npm` package you can now start simplifying requests like so:

```js
var unirest = require('unirest'***REMOVED***;
```

## Creating Requests

You're probably wondering how by using **Unirest** makes creating requests easier. Besides automatically supporting gzip, and parsing responses, lets start with a basic working example:

```js
unirest.post('http://httpbin.org/post'***REMOVED***
.headers({ 'Accept': 'application/json' }***REMOVED***
.send({ "parameter": 23, "foo": "bar" }***REMOVED***
.end(function (response***REMOVED*** {
  console.log(response.body***REMOVED***;
}***REMOVED***;
```

## Uploading Files

Transferring file data has been simplified:

```js
unirest.post('http://httpbin.org/post'***REMOVED***
.headers({ 'Accept': 'application/json' }***REMOVED***
.field('parameter', 'value'***REMOVED*** // Form field
.attach('file', '/tmp/file'***REMOVED*** // Attachment
.end(function (response***REMOVED*** {
  console.log(response.body***REMOVED***;
}***REMOVED***;
```

## Custom Entity Body

```js
unirest.post('http://httpbin.org/post'***REMOVED***
.headers({ 'Accept': 'application/json' }***REMOVED***
.send(new Buffer([1,2,3]***REMOVED******REMOVED***
.end(function (response***REMOVED*** {
  console.log(response.body***REMOVED***;
}***REMOVED***;
```

# Unirest

A request can be initiated by invoking the appropriate method on the unirest object, then calling `.end(***REMOVED***` to send the request. Alternatively you can send the request directly by providing a callback along with the url.

## unirest(method [, uri, headers, body, callback]***REMOVED***

- `method` - Request type (GET, PUT, POST, etc...***REMOVED***
- `uri` - _Optional_; When declared the method will return a [Request](#request***REMOVED*** object. 
          Otherwise it will return the method below with `method` set to the method given.
- `headers` (`Object`***REMOVED*** - _Optional_; Will be aliased to unirest\[method] `headers` argument when `uri` is present.
- `body` (`Mixed`***REMOVED*** - _Optional_; Will be aliased to unirest\[method] `body` argument when `uri` is present.
- `callback` (`Function`***REMOVED*** - _Optional_; Will be aliased to unirest\[method] `callback` argument when `uri` is present.

## unirest\[method](url [, headers, body, callback]***REMOVED***

- `method` - Request type, pre-defined methods, see below.
- `url` - Request location.
- `headers` (`Object` | `Function`***REMOVED*** - _Optional_; When `Object` headers are passed along to the `Request.set(***REMOVED***` method, 
   when `Function` this argument is used as the `callback`.
- `body` (`Mixed` | `Function`***REMOVED*** - _Optional_; When `body` is not a `Function` it will be passed along to `Request.send(***REMOVED***` method,
   otherwise when a `Function` it will be used as the `callback`.
- `callback` (`Function`***REMOVED*** - _Optional_; Calls end with given argument, otherwise `Request` is returned.

All arguments above, with the exclusion of `url`, will accept a `Function` as the `callback`. 
When no `callback` is present, the [Request](#request***REMOVED*** object will be returned.

### get

Returns a [Request](#request***REMOVED*** object with the `method` option set to `GET`

```js
var Request = unirest.get('http://httpbin.org/get'***REMOVED***;
```

### head
Returns a [Request](#request***REMOVED*** object with the `method` option set to `HEAD`

```js
var Request = unirest.head('http://httpbin.org/get'***REMOVED***;
```

### post
Returns a [Request](#request***REMOVED*** object with the `method` option set to `POST`

```js
var Request = unirest.post('http://httpbin.org/post'***REMOVED***;
```

### patch

Returns a [Request](#request***REMOVED*** object with the `method` option set to `PATCH`

```js
var Request = unirest.patch('http://httpbin.org/patch'***REMOVED***;
```

### delete
Returns a [Request](#request***REMOVED*** object with the `method` option set to `DELETE`

```js
var Request = unirest.delete('http://httpbin.org/delete'***REMOVED***;
```

## unirest.jar(***REMOVED***

Creates a container to store multiple cookies, i.e. a cookie jar.

```js
var CookieJar = unirest.jar(***REMOVED***;
CookieJar.add(unirest.cookie('some value'***REMOVED******REMOVED***;
unirest.get('http://httpbin.org/get'***REMOVED***.jar(CookieJar***REMOVED***;
```

## unirest.cookie(String***REMOVED***

Creates a cookie, see above for example.

## unirest.request

`mikeal/request` library (the underlying layer of unirest-nodejs***REMOVED*** for direct use.

# Request

Provides simple and easy to use methods for manipulating the request prior to being sent. This object is created when a 
Unirest Method is invoked. This object contains methods that are chainable like other libraries such as jQuery and popular 
request module Superagent (which this library is modeled after slightly***REMOVED***.

**Example**

```js
var Request = unirest.post('http://httpbin.org/post'***REMOVED***;

Request.headers({
  'Accepts': 'application/json'
}***REMOVED***.end(function (response***REMOVED*** {
  ...
}***REMOVED***;
```

## Request Methods

Request Methods differ from Option Methods (See Below***REMOVED*** in that these methods transform, or handle the data in a sugared way, where as Option Methods require a more _hands on_ approach.

#### Request.auth(Object***REMOVED*** or (user, pass, sendImmediately***REMOVED***

Accepts either an `Object` containing `user`, `pass`, and optionally `sendImmediately`.

- `user` (`String`***REMOVED*** - Authentication Username
- `pass` (`String`***REMOVED*** - Authentication Password
- `sendImmediately` (`String`***REMOVED*** - _Optional_; Defaults to `true`; Flag to determine whether Request should send the basic authentication header along with the request. Upon being _false_, Request will retry with a _proper_ authentication header after receiving a `401` response from the server (which must contain a `WWW-Authenticate` header indicating the required authentication method***REMOVED***

**Object**

```js
Request.auth({
  user: 'Nijiko',
  pass: 'insecure',
  sendImmediately: true
}***REMOVED***;
```

**Arguments**

```
Request.auth('Nijiko', 'insecure', true***REMOVED***;
```

#### Request.header(Object***REMOVED*** or (field, value***REMOVED***

**Suggested Method for setting Headers**

Accepts either an `Object` containing `header-name: value` entries,
or `field` and `value` arguments. Each entry is then stored in a two locations, one in the case-sensitive `Request.options.headers` and the other on a private `_headers` object that is case-insensitive for internal header lookup.

- `field` (`String`***REMOVED*** - Header name, such as `Accepts`
- `value` (`String`***REMOVED*** - Header value, such as `application/json` 

**Object**

```js
Request.set({
  'Accepts': 'application/json'
, 'User-Agent': 'Unirest Node.js'
}***REMOVED***
```

**Arguments**

```
Request.set('Accepts', 'application/json'***REMOVED***;
```

#### Request.part(Object***REMOVED***

**Experimental**

Similiar to `Request.multipart(***REMOVED***` except it only allows one object to be passed at a time and does the pre-processing on necessary `body` values for you.

Each object is then appended to the `Request.options.multipart` array.

```js
Request.part({
  'content-type': 'application/json'
, body: { foo: 'bar' }
}***REMOVED***.part({
  'content-type': 'text/html'
, body: '<strong>Hello World!</strong>'
}***REMOVED***;
```

#### Request.query(Object***REMOVED*** or (String***REMOVED***

When `Object` is passed value is processed as a `querystring` representation, otherwise we directly use the `String` passed and append it to `Request.options.url`. If `Request.options.url` has a trailing `?` already, we append it with `& + value` otherwise we append as `? + value`

```js
unirest.post('http://httpbin.org/get'***REMOVED***
.query('name=nijiko'***REMOVED***
.query({
  pet: 'spot'
}***REMOVED***
.end(function (response***REMOVED*** {
  console.log(response***REMOVED***;
}***REMOVED***;
```

#### Request.send(Object | String***REMOVED***

Ease of use method for setting the body without having to worry about processing the data for popular formats such as `JSON`, `Form Encoded`, otherwise the `body` is set on `Request.options` as the given value.

By default sending strings with no `Content-Type` preset will set `Content-Type` to `application/x-www-form-urlencoded`, and multiple calls will be concatenated with `&`. Otherwise multiple calls will be appended to the previous `body` value.

**JSON**

```js
unirest.post('http://httpbin.org/post'***REMOVED***
.type('json'***REMOVED***
.send({
  foo: 'bar',
  hello: 3
}***REMOVED***
.end(function (response***REMOVED*** {
  console.log(response.body***REMOVED***;
}***REMOVED***
```

**FORM Encoded**

```js
// Body would be:
// name=nijiko&pet=turtle
unirest.post('http://httpbin.org/post'***REMOVED***
.send('name=nijiko'***REMOVED***
.send('pet=spot'***REMOVED***
.end(function (response***REMOVED*** {
  console.log(response.body***REMOVED***;
}***REMOVED***;
```

**HTML / Other**

```js
unirest.post('http://httpbin.org/post'***REMOVED***
.set('Content-Type', 'text/html'***REMOVED***
.send('<strong>Hello World!</strong>'***REMOVED***
.end(function (response***REMOVED*** {
  console.log(response.body***REMOVED***;
}***REMOVED***;
```

#### Request.type(String***REMOVED***

Sets the header `Content-Type` through either lookup for extensions (`xml`, `png`, `json`, etc...***REMOVED*** using `mime` or using the full value such as `application/json`. 

Uses `Request.header(***REMOVED***` to set header value.

```js
Request.type('application/json'***REMOVED*** // Content-Type: application/json
Request.type('json'***REMOVED*** // Content-Type: application/json
Request.type('html'***REMOVED*** // Content-Type: text/html
…
```

## Request Form Methods

The following methods are sugar methods for attaching files, and form fields. Instead of handling files and processing them yourself Unirest can do that for you.

#### Request.attach(Object***REMOVED*** or (name, path***REMOVED***

`Object` should consist of `name: 'path'` otherwise use `name` and `path`.

- `name` (`String`***REMOVED*** - File field name
- `path` (`String` | `Object`***REMOVED*** - File value, A `String` will be parsed based on its value. If `path` contains `http` or `https` Request will handle it as a `remote file`, otherwise if it contains `://` and not `http` or `https` it will consider it to be a `direct file path`. If no `://` is found it will be considered a `relative file path`. An `Object` is directly set, so you can do pre-processing if you want without worrying about the string value.

**Object**

```js
unirest.post('http://httpbin.org/post'***REMOVED***
.headers({ 'Accept': 'application/json' }***REMOVED***
.field({
  'parameter': 'value'
}***REMOVED***
.attach({
  'file': 'dog.png'
, 'relative file': fs.createReadStream(path.join(__dirname, 'dog.png'***REMOVED***,
, 'remote file': unirest.request('http://google.com/doodle.png'***REMOVED***
}***REMOVED***
.end(function (response***REMOVED*** {
  console.log(response.body***REMOVED***;
}***REMOVED***
```

**Arguments**

```js
unirest.post('http://httpbin.org/post'***REMOVED***
.headers({ 'Accept': 'application/json' }***REMOVED***
.field('parameter', 'value'***REMOVED*** // Form field
.attach('file', 'dog.png'***REMOVED*** // Attachment
.attach('remote file', fs.createReadStream(path.join(__dirname, 'dog.png'***REMOVED******REMOVED*** // Same as above.
.attach('remote file', unirest.request('http://google.com/doodle.png'***REMOVED******REMOVED***
.end(function (response***REMOVED*** {
  console.log(response.body***REMOVED***;
}***REMOVED***;
```

#### Request.field(Object***REMOVED*** or (name, value***REMOVED***

`Object` should consist of `name: 'value'` otherwise use `name` and `value`

See `Request.attach` for usage.

## Request.options

The _options_ `object` is where almost all of the request settings live. Each option method sugars to a field on this object to allow for chaining and ease of use. If 
you have trouble with an option method and wish to directly access the _options_ object
you are free to do so.

This object is modeled after the `request` libraries options that are passed along through its constructor.

* `url` (`String` | `Object`***REMOVED*** - Url, or object parsed from `url.parse(***REMOVED***`
* `qs` (`Object`***REMOVED*** - Object consisting of `querystring` values to append to `url` upon request.
* `method` (`String`***REMOVED*** - Default `GET`; HTTP Method.
* `headers` (`Object`***REMOVED*** - Default `{}`; HTTP Headers.
* `body` (`String` | `Object`***REMOVED*** - Entity body for certain requests.
* `form` (`Object`***REMOVED*** - Form data.
* `auth` (`Object`***REMOVED*** - See `Request.auth(***REMOVED***` below.
* `multipart` (`Object`***REMOVED*** - _Experimental_; See documentation below.
* `followRedirect` (`Boolean`***REMOVED*** - Default `true`; Follow HTTP `3xx` responses as redirects.
* `followAllRedirects` (`Boolean`***REMOVED*** - Default `false`; Follow **Non**-GET HTTP `3xx` responses as redirects.
* `maxRedirects` (`Number`***REMOVED*** - Default `10`; Maximum number of redirects before aborting.
* `encoding` (`String`***REMOVED*** - Encoding to be used on `setEncoding` of response data.
* `timeout` (`Number`***REMOVED*** - Number of milliseconds to wait before aborting.
* `proxy` (`String`***REMOVED*** - See `Request.proxy(***REMOVED***` below.
* `oauth` (`Object`***REMOVED*** - See `Request.oauth(***REMOVED***` below.
* `hawk` (`Object`***REMOVED*** - See `Request.hawk(***REMOVED***` below
* `strictSSL` (`Boolean`***REMOVED*** - Default `true`; See `Request.strictSSL(***REMOVED***` below.
* `secureProtocol` (`String`***REMOVED*** - See `Request.secureProtocol(***REMOVED***` below.
* `jar` (`Boolean` | `Jar`***REMOVED*** - See `Request.jar(***REMOVED***` below.
* `aws` (`Object`***REMOVED*** - See `Request.aws(***REMOVED***` below.
* `httpSignature` (`Object`***REMOVED*** - See `Request.httpSignature(***REMOVED***` Below.
* `localAddress` (`String`***REMOVED*** - See `Request.localAddress(***REMOVED***` Below.
* `pool` && `pool.maxSockets` - Advanced agent technology, that is supported.

## Request Option Methods

#### Request.url(String***REMOVED***

Sets `url` location of the current request on `Request.options` to the given `String`

```js
Request.url('http://httpbin.org/get'***REMOVED***;
```

#### Request.method(String***REMOVED***

Sets `method` value on `Request.options` to the given value.

```js
Request.method('HEAD'***REMOVED***;
```

#### Request.form(Object***REMOVED***

Sets `form` object on `Request.options` to the given object.

When used `body` is set to the object passed as a `querystring` representation and the `Content-Type` header to `application/x-www-form-urlencoded; charset=utf-8`

```js
Request.form({
  key: 'value'
}***REMOVED***;
```

#### Request.multipart(Array***REMOVED***

**Experimental**

Sets `multipart` array containing multipart-form objects on `Request.options` to be sent along with the Request.

Each objects property with the exclusion of `body` is treated as a header value. Each `body` value must be pre-processed if necessary when using this method.

```js
Request.multipart([{
  'content-type': 'application/json'
, body: JSON.stringify({
    foo: 'bar'
***REMOVED******REMOVED***
}, {
  'content-type': 'text/html'
, body: '<strong>Hello World!</strong>'
}]***REMOVED***;
```

#### Request.maxRedirects(Number***REMOVED***

Sets `maxRedirects`, the number of redirects the current Request will follow, on `Request.options` based on the given value.

```js
Request.maxRedirects(6***REMOVED***
```

#### Request.followRedirect(Boolean***REMOVED***

Sets `followRedirect` flag on `Request.options` for whether the current Request should follow HTTP redirects based on the given value.

```js
Request.followRedirect(true***REMOVED***;
```

#### Request.timeout(Number***REMOVED***

Sets `timeout`, number of milliseconds Request should wait for a response before aborting, on `Request.options` based on the given value.

```js
Request.timeout(2000***REMOVED***
```

#### Request.encoding(String***REMOVED***

Sets `encoding`, encoding to be used on setEncoding of response data if set to null, the body is returned as a Buffer, on `Request.options` based on given value.

```js
Request.encoding('utf-8'***REMOVED***
```

#### Request.strictSSL(Boolean***REMOVED***

Sets `strictSSL` flag to require that SSL certificates be valid on `Request.options` based on given value.

```js
Request.strictSSL(true***REMOVED***;
``` 

#### Request.httpSignature(Object***REMOVED***

Sets `httpSignature` 

#### Request.proxy(String***REMOVED***

Sets `proxy`, HTTP Proxy to be set on `Request.options` based on value.

```js
Request.proxy('http://localproxy.com'***REMOVED***;
```

#### Request.secureProtocol(String***REMOVED***

Sets the secure protocol to use:

```js
Request.secureProtocol('SSLv2_method'***REMOVED***;
// or 
Request.secureProtocol('SSLv3_client_method'***REMOVED***;
```

See [openssl.org](https://www.openssl.org/docs/ssl/SSL_CTX_new.html***REMOVED*** for all possible values.

#### Request.aws(Object***REMOVED***

Sets `aws`, AWS Signing Credentials, on `Request.options`

```js
Request.aws({ 
  key: 'AWS_S3_KEY'
, secret: 'AWS_S3_SECRET'
, bucket: 'BUCKET NAME'
}***REMOVED***;
```

#### Request.oauth(Object***REMOVED***

Sets `oauth`, list of oauth credentials, on `Request.options` based on given object.

```js
var Request = unirest.get('https://api.twitter.com/oauth/request_token'***REMOVED***;

Request.oauth({
  callback: 'http://mysite.com/callback/'
, consumer_key: 'CONSUMER_KEY'
, consumer_secret: 'CONSUMER_SECRET'
}***REMOVED***.end(function (response***REMOVED*** {
  var access_token = response.body;
  
  Request = unirest.post('https://api.twitter.com/oauth/access_token'***REMOVED***;
  Request.oauth({
    consumer_key: 'CONSUMER_KEY'
  , consumer_secret: 'CONSUMER_SECRET'
  , token: access_token.oauth_token
  , verifier: token: access_token.oauth_verifier
***REMOVED******REMOVED***.end(function (response***REMOVED*** {
    var token = response.body;
    
    Request = unirest.get('https://api.twitter.com/1/users/show.json'***REMOVED***;
    Request.oauth({
      consumer_key: 'CONSUMER_KEY'
    , consumer_secret: 'CONSUMER_SECRET'
    , token: token.oauth_token
    , token_secret: token.oauth_token_secret
  ***REMOVED******REMOVED***.query({
      screen_name: token.screen_name
    , user_id: token.user_id
  ***REMOVED******REMOVED***.end(function (response***REMOVED*** {
      console.log(response.body***REMOVED***;
  ***REMOVED******REMOVED***;
***REMOVED******REMOVED***
}***REMOVED***;
```

#### Request.hawk(Object***REMOVED***

Sets `hawk` object on `Request.options` to the given object.

Hawk requires a field `credentials` as seen in their [documentation](https://github.com/hueniverse/hawk#usage-example***REMOVED***, and below.

```js
Request.hawk({
  credentials: {
    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn'
  , algorithm: 'sha256'
  , user: 'Steve'
***REMOVED***
}***REMOVED***;
```

#### Request.localAddress(String***REMOVED***

Sets `localAddress`, local interface to bind for network connections, on `Request.options`

```js
Request.localAddress('127.0.0.1'***REMOVED***;
Request.localAddress('1.2.3.4'***REMOVED***;
```

#### Request.jar(Boolean***REMOVED*** or Request.jar(Jar***REMOVED***

Sets `jar`, cookie container, on `Request.options`. When set to `true` it stores cookies for future usage.

See `unirest.jar` for more information on how to use `Jar` argument.

## Request Aliases

#### Request.set

**Alias** for `Request.header(***REMOVED***`

#### Request.headers

**Alias** for `Request.header(***REMOVED***`

#### Request.redirects

**Alias** for `Request.maxRedirects(***REMOVED***`

#### Request.redirect

**Alias** for `Request.followRedirect(***REMOVED***`

#### Request.ssl

**Alias** for `Request.strictSSL(***REMOVED***`

#### Request.ip

**Alias** for `Request.localAddress(***REMOVED***`

#### Request.complete

**Alias** for `Request.end(***REMOVED***`

#### Request.as.json

**Alias** for `Request.end(***REMOVED***`

#### Request.as.binary

**Alias** for `Request.end(***REMOVED***`

#### Request.as.string

**Alias** for `Request.end(***REMOVED***`

# Response

Upon ending a request, and recieving a Response the object that is returned contains a number of helpful properties to ease coding pains.

## General


- `body` (`Mixed`***REMOVED*** - Processed body data
- `raw_body` (`Mixed`***REMOVED*** - Unprocessed body data
- `headers` (`Object`***REMOVED*** - Header details
- `cookies` (`Object`***REMOVED*** - Cookies from `set-cookies`, and `cookie` headers.
- `httpVersion` (`String`***REMOVED*** - Server http version. (e.g. 1.1***REMOVED***
- `httpVersionMajor` (`Number`***REMOVED*** - Major number (e.g. 1***REMOVED***
- `httpVersionMinor` (`Number`***REMOVED*** - Minor number (e.g. 1***REMOVED***
- `url` (`String`***REMOVED*** - Dependant on input, can be empty.
- `domain` (`String` | `null`***REMOVED*** - Dependant on input, can be empty.
- `method` (`String` | `null`***REMOVED*** - Method used, dependant on input.
- `client` (`Object`***REMOVED*** - Client Object. Detailed information regarding the Connection and Byte throughput.
- `connection` (`Object`***REMOVED*** - Client Object. Specific connection object, useful for events such as errors. **Advanced**
- `socket` (`Object`***REMOVED*** Client Object. Socket specific object and information. Most throughput is same across all three client objects.
- `request` (`Object`***REMOVED*** - Initial request object.
- `setEncoding` (`Function`***REMOVED*** - Set encoding type.

## Status Information

- `code` (`Number`***REMOVED*** - Status Code, i.e. `200`
- `status` (`Number`***REMOVED*** - Status Code, same as above.
- `statusType` (`Number`***REMOVED*** - Status Code Range Type
  - `1` - Info
  - `2` - Ok
  - `3` - Miscellaneous
  - `4` - Client Error
  - `5` - Server Error
- `info` (`Boolean`***REMOVED*** - Status Range Info?
- `ok` (`Boolean`***REMOVED*** - Status Range Ok?
- `clientError` (`Boolean`***REMOVED*** - Status Range Client Error?
- `serverError` (`Boolean`***REMOVED*** - Status Range Server Error?
- `accepted` (`Boolean`***REMOVED*** - Status Code `202`?
- `noContent` (`Boolean`***REMOVED*** - Status Code `204` or `1223`?
- `badRequest` (`Boolean`***REMOVED*** - Status Code `400`?
- `unauthorized` (`Boolean`***REMOVED*** - Status Code `401`?
- `notAcceptable` (`Boolean`***REMOVED*** - Status Code `406`?
- `notFound` (`Boolean`***REMOVED*** - Status Code `404`?
- `forbidden` (`Boolean`***REMOVED*** - Status Code `403`?
- `error` (`Boolean` | `Object`***REMOVED*** - Dependant on status code range.

## response.cookie(name***REMOVED***

Sugar method for retrieving a cookie from the `response.cookies` object.


```js
var CookieJar = unirest.jar(***REMOVED***;
CookieJar.add(unirest.cookie('another cookie=23'***REMOVED******REMOVED***;

unirest.get('http://google.com'***REMOVED***.jar(CookieJar***REMOVED***.end(function (response***REMOVED*** {
  // Except google trims the value passed :/
  console.log(response.cookie('another cookie'***REMOVED******REMOVED***;
}***REMOVED***;
```
