# Request -- Simplified HTTP client

[![NPM](https://nodei.co/npm/request.png***REMOVED***](https://nodei.co/npm/request/***REMOVED***

## Super simple to use

Request is designed to be the simplest way possible to make http calls. It supports HTTPS and follows redirects by default.

```javascript
var request = require('request'***REMOVED***;
request('http://www.google.com', function (error, response, body***REMOVED*** {
  if (!error && response.statusCode == 200***REMOVED*** {
    console.log(body***REMOVED*** // Print the google web page.
***REMOVED***
}***REMOVED***
```

## Streaming

You can stream any response to a file stream.

```javascript
request('http://google.com/doodle.png'***REMOVED***.pipe(fs.createWriteStream('doodle.png'***REMOVED******REMOVED***
```

You can also stream a file to a PUT or POST request. This method will also check the file extension against a mapping of file extensions to content-types (in this case `application/json`***REMOVED*** and use the proper `content-type` in the PUT request (if the headers don’t already provide one***REMOVED***.

```javascript
fs.createReadStream('file.json'***REMOVED***.pipe(request.put('http://mysite.com/obj.json'***REMOVED******REMOVED***
```

Request can also `pipe` to itself. When doing so, `content-type` and `content-length` are preserved in the PUT headers.

```javascript
request.get('http://google.com/img.png'***REMOVED***.pipe(request.put('http://mysite.com/img.png'***REMOVED******REMOVED***
```

Now let’s get fancy.

```javascript
http.createServer(function (req, resp***REMOVED*** {
  if (req.url === '/doodle.png'***REMOVED*** {
    if (req.method === 'PUT'***REMOVED*** {
      req.pipe(request.put('http://mysite.com/doodle.png'***REMOVED******REMOVED***
  ***REMOVED*** else if (req.method === 'GET' || req.method === 'HEAD'***REMOVED*** {
      request.get('http://mysite.com/doodle.png'***REMOVED***.pipe(resp***REMOVED***
  ***REMOVED***
***REMOVED***
}***REMOVED***
```

You can also `pipe(***REMOVED***` from `http.ServerRequest` instances, as well as to `http.ServerResponse` instances. The HTTP method, headers, and entity-body data will be sent. Which means that, if you don't really care about security, you can do:

```javascript
http.createServer(function (req, resp***REMOVED*** {
  if (req.url === '/doodle.png'***REMOVED*** {
    var x = request('http://mysite.com/doodle.png'***REMOVED***
    req.pipe(x***REMOVED***
    x.pipe(resp***REMOVED***
***REMOVED***
}***REMOVED***
```

And since `pipe(***REMOVED***` returns the destination stream in ≥ Node 0.5.x you can do one line proxying. :***REMOVED***

```javascript
req.pipe(request('http://mysite.com/doodle.png'***REMOVED******REMOVED***.pipe(resp***REMOVED***
```

Also, none of this new functionality conflicts with requests previous features, it just expands them.

```javascript
var r = request.defaults({'proxy':'http://localproxy.com'}***REMOVED***

http.createServer(function (req, resp***REMOVED*** {
  if (req.url === '/doodle.png'***REMOVED*** {
    r.get('http://google.com/doodle.png'***REMOVED***.pipe(resp***REMOVED***
***REMOVED***
}***REMOVED***
```

You can still use intermediate proxies, the requests will still follow HTTP forwards, etc.

## UNIX Socket 

`request` supports the `unix://` protocol for all requests. The path is assumed to be absolute to the root of the host file system. 

HTTP paths are extracted from the supplied URL by testing each level of the full URL against net.connect for a socket response.

Thus the following request will GET `/httppath` from the HTTP server listening on `/tmp/unix.socket`

```javascript
request.get('unix://tmp/unix.socket/httppath'***REMOVED***
```

## Forms

`request` supports `application/x-www-form-urlencoded` and `multipart/form-data` form uploads. For `multipart/related` refer to the `multipart` API.

URL-encoded forms are simple.

```javascript
request.post('http://service.com/upload', {form:{key:'value'}}***REMOVED***
// or
request.post('http://service.com/upload'***REMOVED***.form({key:'value'}***REMOVED***
```

For `multipart/form-data` we use the [form-data](https://github.com/felixge/node-form-data***REMOVED*** library by [@felixge](https://github.com/felixge***REMOVED***. You don’t need to worry about piping the form object or setting the headers, `request` will handle that for you.

```javascript
var r = request.post('http://service.com/upload'***REMOVED***
var form = r.form(***REMOVED***
form.append('my_field', 'my_value'***REMOVED***
form.append('my_buffer', new Buffer([1, 2, 3]***REMOVED******REMOVED***
form.append('my_file', fs.createReadStream(path.join(__dirname, 'doodle.png'***REMOVED******REMOVED***
form.append('remote_file', request('http://google.com/doodle.png'***REMOVED******REMOVED***
```

## HTTP Authentication

```javascript
request.get('http://some.server.com/'***REMOVED***.auth('username', 'password', false***REMOVED***;
// or
request.get('http://some.server.com/', {
  'auth': {
    'user': 'username',
    'pass': 'password',
    'sendImmediately': false
***REMOVED***
}***REMOVED***;
```

If passed as an option, `auth` should be a hash containing values `user` || `username`, `password` || `pass`, and `sendImmediately` (optional***REMOVED***.  The method form takes parameters `auth(username, password, sendImmediately***REMOVED***`.

`sendImmediately` defaults to `true`, which causes a basic authentication header to be sent.  If `sendImmediately` is `false`, then `request` will retry with a proper authentication header after receiving a `401` response from the server (which must contain a `WWW-Authenticate` header indicating the required authentication method***REMOVED***.

Digest authentication is supported, but it only works with `sendImmediately` set to `false`; otherwise `request` will send basic authentication on the initial request, which will probably cause the request to fail.

## OAuth Signing

```javascript
// Twitter OAuth
var qs = require('querystring'***REMOVED***
  , oauth =
    { callback: 'http://mysite.com/callback/'
    , consumer_key: CONSUMER_KEY
    , consumer_secret: CONSUMER_SECRET
  ***REMOVED***
  , url = 'https://api.twitter.com/oauth/request_token'
  ;
request.post({url:url, oauth:oauth}, function (e, r, body***REMOVED*** {
  // Ideally, you would take the body in the response
  // and construct a URL that a user clicks on (like a sign in button***REMOVED***.
  // The verifier is only available in the response after a user has
  // verified with twitter that they are authorizing your app.
  var access_token = qs.parse(body***REMOVED***
    , oauth =
      { consumer_key: CONSUMER_KEY
      , consumer_secret: CONSUMER_SECRET
      , token: access_token.oauth_token
      , verifier: access_token.oauth_verifier
    ***REMOVED***
    , url = 'https://api.twitter.com/oauth/access_token'
    ;
  request.post({url:url, oauth:oauth}, function (e, r, body***REMOVED*** {
    var perm_token = qs.parse(body***REMOVED***
      , oauth =
        { consumer_key: CONSUMER_KEY
        , consumer_secret: CONSUMER_SECRET
        , token: perm_token.oauth_token
        , token_secret: perm_token.oauth_token_secret
      ***REMOVED***
      , url = 'https://api.twitter.com/1.1/users/show.json?'
      , params =
        { screen_name: perm_token.screen_name
        , user_id: perm_token.user_id
      ***REMOVED***
      ;
    url += qs.stringify(params***REMOVED***
    request.get({url:url, oauth:oauth, json:true}, function (e, r, user***REMOVED*** {
      console.log(user***REMOVED***
  ***REMOVED******REMOVED***
***REMOVED******REMOVED***
}***REMOVED***
```

### Custom HTTP Headers

HTTP Headers, such as `User-Agent`, can be set in the `options` object.
In the example below, we call the github API to find out the number
of stars and forks for the request repository. This requires a
custom `User-Agent` header as well as https.

```javascript
var request = require('request'***REMOVED***;

var options = {
	url: 'https://api.github.com/repos/mikeal/request',
	headers: {
		'User-Agent': 'request'
	}
};

function callback(error, response, body***REMOVED*** {
	if (!error && response.statusCode == 200***REMOVED*** {
		var info = JSON.parse(body***REMOVED***;
		console.log(info.stargazers_count + " Stars"***REMOVED***;
		console.log(info.forks_count + " Forks"***REMOVED***;
	}
}

request(options, callback***REMOVED***;
```

### request(options, callback***REMOVED***

The first argument can be either a `url` or an `options` object. The only required option is `uri`; all others are optional.

* `uri` || `url` - fully qualified uri or a parsed url object from `url.parse(***REMOVED***`
* `qs` - object containing querystring values to be appended to the `uri`
* `method` - http method (default: `"GET"`***REMOVED***
* `headers` - http headers (default: `{}`***REMOVED***
* `body` - entity body for PATCH, POST and PUT requests. Must be a `Buffer` or `String`.
* `form` - when passed an object, this sets `body` to a querystring representation of value, and adds `Content-type: application/x-www-form-urlencoded; charset=utf-8` header. When passed no options, a `FormData` instance is returned (and is piped to request***REMOVED***.
* `auth` - A hash containing values `user` || `username`, `password` || `pass`, and `sendImmediately` (optional***REMOVED***.  See documentation above.
* `json` - sets `body` but to JSON representation of value and adds `Content-type: application/json` header.  Additionally, parses the response body as JSON.
* `multipart` - (experimental***REMOVED*** array of objects which contains their own headers and `body` attribute. Sends `multipart/related` request. See example below.
* `followRedirect` - follow HTTP 3xx responses as redirects (default: `true`***REMOVED***
* `followAllRedirects` - follow non-GET HTTP 3xx responses as redirects (default: `false`***REMOVED***
* `maxRedirects` - the maximum number of redirects to follow (default: `10`***REMOVED***
* `encoding` - Encoding to be used on `setEncoding` of response data. If `null`, the `body` is returned as a `Buffer`.
* `pool` - A hash object containing the agents for these requests. If omitted, the request will use the global pool (which is set to node's default `maxSockets`***REMOVED***
* `pool.maxSockets` - Integer containing the maximum amount of sockets in the pool.
* `timeout` - Integer containing the number of milliseconds to wait for a request to respond before aborting the request
* `proxy` - An HTTP proxy to be used. Supports proxy Auth with Basic Auth, identical to support for the `url` parameter (by embedding the auth info in the `uri`***REMOVED***
* `oauth` - Options for OAuth HMAC-SHA1 signing. See documentation above.
* `hawk` - Options for [Hawk signing](https://github.com/hueniverse/hawk***REMOVED***. The `credentials` key must contain the necessary signing info, [see hawk docs for details](https://github.com/hueniverse/hawk#usage-example***REMOVED***.
* `strictSSL` - If `true`, requires SSL certificates be valid. **Note:** to use your own certificate authority, you need to specify an agent that was created with that CA as an option.
* `jar` - If `true`, remember cookies for future use (or define your custom cookie jar; see examples section***REMOVED***
* `aws` - `object` containing AWS signing information. Should have the properties `key`, `secret`. Also requires the property `bucket`, unless you’re specifying your `bucket` as part of the path, or the request doesn’t use a bucket (i.e. GET Services***REMOVED***
* `httpSignature` - Options for the [HTTP Signature Scheme](https://github.com/joyent/node-http-signature/blob/master/http_signing.md***REMOVED*** using [Joyent's library](https://github.com/joyent/node-http-signature***REMOVED***. The `keyId` and `key` properties must be specified. See the docs for other options.
* `localAddress` - Local interface to bind for network connections.


The callback argument gets 3 arguments: 

1. An `error` when applicable (usually from [`http.ClientRequest`](http://nodejs.org/api/http.html#http_class_http_clientrequest***REMOVED*** object***REMOVED***
2. An [`http.IncomingMessage`](http://nodejs.org/api/http.html#http_http_incomingmessage***REMOVED*** object
3. The third is the `response` body (`String` or `Buffer`, or JSON object if the `json` option is supplied***REMOVED***

## Convenience methods

There are also shorthand methods for different HTTP METHODs and some other conveniences.

### request.defaults(options***REMOVED***

This method returns a wrapper around the normal request API that defaults to whatever options you pass in to it.

### request.put

Same as `request(***REMOVED***`, but defaults to `method: "PUT"`.

```javascript
request.put(url***REMOVED***
```

### request.patch

Same as `request(***REMOVED***`, but defaults to `method: "PATCH"`.

```javascript
request.patch(url***REMOVED***
```

### request.post

Same as `request(***REMOVED***`, but defaults to `method: "POST"`.

```javascript
request.post(url***REMOVED***
```

### request.head

Same as request(***REMOVED*** but defaults to `method: "HEAD"`.

```javascript
request.head(url***REMOVED***
```

### request.del

Same as `request(***REMOVED***`, but defaults to `method: "DELETE"`.

```javascript
request.del(url***REMOVED***
```

### request.get

Same as `request(***REMOVED***` (for uniformity***REMOVED***.

```javascript
request.get(url***REMOVED***
```
### request.cookie

Function that creates a new cookie.

```javascript
request.cookie('cookie_string_here'***REMOVED***
```
### request.jar

Function that creates a new cookie jar.

```javascript
request.jar(***REMOVED***
```


## Examples:

```javascript
  var request = require('request'***REMOVED***
    , rand = Math.floor(Math.random(***REMOVED****100000000***REMOVED***.toString(***REMOVED***
    ;
  request(
    { method: 'PUT'
    , uri: 'http://mikeal.iriscouch.com/testjs/' + rand
    , multipart:
      [ { 'content-type': 'application/json'
        ,  body: JSON.stringify({foo: 'bar', _attachments: {'message.txt': {follows: true, length: 18, 'content_type': 'text/plain' }}}***REMOVED***
      ***REMOVED***
      , { body: 'I am an attachment' }
      ]
  ***REMOVED***
  , function (error, response, body***REMOVED*** {
      if(response.statusCode == 201***REMOVED***{
        console.log('document saved as: http://mikeal.iriscouch.com/testjs/'+ rand***REMOVED***
    ***REMOVED*** else {
        console.log('error: '+ response.statusCode***REMOVED***
        console.log(body***REMOVED***
    ***REMOVED***
  ***REMOVED***
  ***REMOVED***
```

Cookies are disabled by default (else, they would be used in subsequent requests***REMOVED***. To enable cookies, set `jar` to `true` (either in `defaults` or `options`***REMOVED***.

```javascript
var request = request.defaults({jar: true}***REMOVED***
request('http://www.google.com', function (***REMOVED*** {
  request('http://images.google.com'***REMOVED***
}***REMOVED***
```

To use a custom cookie jar (instead `request`’s global cookie jar***REMOVED***, set `jar` to an instance of `request.jar(***REMOVED***` (either in `defaults` or `options`***REMOVED***

```javascript
var j = request.jar(***REMOVED***
var request = request.defaults({jar:j}***REMOVED***
request('http://www.google.com', function (***REMOVED*** {
  request('http://images.google.com'***REMOVED***
}***REMOVED***
```

OR

```javascript
var j = request.jar(***REMOVED***
var cookie = request.cookie('your_cookie_here'***REMOVED***
j.setCookie(cookie, uri***REMOVED***;
request({url: 'http://www.google.com', jar: j}, function (***REMOVED*** {
  request('http://images.google.com'***REMOVED***
}***REMOVED***
```
