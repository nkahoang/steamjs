# Form-Data [![Build Status](https://travis-ci.org/felixge/node-form-data.png?branch=master***REMOVED***](https://travis-ci.org/felixge/node-form-data***REMOVED*** [![Dependency Status](https://gemnasium.com/felixge/node-form-data.png***REMOVED***](https://gemnasium.com/felixge/node-form-data***REMOVED***

A module to create readable ```"multipart/form-data"``` streams. Can be used to submit forms and file uploads to other web applications.

The API of this module is inspired by the [XMLHttpRequest-2 FormData Interface][xhr2-fd].

[xhr2-fd]: http://dev.w3.org/2006/webapi/XMLHttpRequest-2/Overview.html#the-formdata-interface
[streams2-thing]: http://nodejs.org/api/stream.html#stream_compatibility_with_older_node_versions

## Install

```
npm install form-data
```

## Usage

In this example we are constructing a form with 3 fields that contain a string,
a buffer and a file stream.

``` javascript
var FormData = require('form-data'***REMOVED***;
var fs = require('fs'***REMOVED***;

var form = new FormData(***REMOVED***;
form.append('my_field', 'my value'***REMOVED***;
form.append('my_buffer', new Buffer(10***REMOVED******REMOVED***;
form.append('my_file', fs.createReadStream('/foo/bar.jpg'***REMOVED******REMOVED***;
```

Also you can use http-response stream:

``` javascript
var FormData = require('form-data'***REMOVED***;
var ***REMOVED***;

var form = new FormData(***REMOVED***;

http.request('http://nodejs.org/images/logo.png', function(response***REMOVED*** {
  form.append('my_field', 'my value'***REMOVED***;
  form.append('my_buffer', new Buffer(10***REMOVED******REMOVED***;
  form.append('my_logo', response***REMOVED***;
}***REMOVED***;
```

Or @mikeal's request stream:

``` javascript
var FormData = require('form-data'***REMOVED***;
var request = require('request'***REMOVED***;

var form = new FormData(***REMOVED***;

form.append('my_field', 'my value'***REMOVED***;
form.append('my_buffer', new Buffer(10***REMOVED******REMOVED***;
form.append('my_logo', request('http://nodejs.org/images/logo.png'***REMOVED******REMOVED***;
```

In order to submit this form to a web application, call ```submit(url, [callback]***REMOVED***``` method:

``` javascript
form.submit('http://example.org/', function(err, res***REMOVED*** {
  // res â€“ response object (http.IncomingMessage***REMOVED***  //
  res.resume(***REMOVED***; // for node-0.10.x
}***REMOVED***;

```

For more advanced request manipulations ```submit(***REMOVED***``` method returns ```http.ClientRequest``` object, or you can choose from one of the alternative submission methods.

### Alternative submission methods

You can use node's http client interface:

``` javascript
var ***REMOVED***;

var request = http.request({
  method: 'post',
  host: 'example.org',
  path: '/upload',
  headers: form.getHeaders(***REMOVED***
}***REMOVED***;

form.pipe(request***REMOVED***;

request.on('response', function(res***REMOVED*** {
  console.log(res.statusCode***REMOVED***;
}***REMOVED***;
```

Or if you would prefer the `'Content-Length'` header to be set for you:

``` javascript
form.submit('example.org/upload', function(err, res***REMOVED*** {
  console.log(res.statusCode***REMOVED***;
}***REMOVED***;
```

To use custom headers and pre-known length in parts:

``` javascript
var CRLF = '\r\n';
var form = new FormData(***REMOVED***;

var options = {
  header: CRLF + '--' + form.getBoundary(***REMOVED*** + CRLF + 'X-Custom-Header: 123' + CRLF + CRLF,
  knownLength: 1
};

form.append('my_buffer', buffer, options***REMOVED***;

form.submit('http://example.com/', function(err, res***REMOVED*** {
  if (err***REMOVED*** throw err;
  console.log('Done'***REMOVED***;
}***REMOVED***;
```

Form-Data can recognize and fetch all the required information from common types of streams (```fs.readStream```, ```http.response``` and ```mikeal's request```***REMOVED***, for some other types of streams you'd need to provide "file"-related information manually:

``` javascript
someModule.stream(function(err, stdout, stderr***REMOVED*** {
  if (err***REMOVED*** throw err;

  var form = new FormData(***REMOVED***;

  form.append('file', stdout, {
    filename: 'unicycle.jpg',
    contentType: 'image/jpg',
    knownLength: 19806
***REMOVED******REMOVED***;

  form.submit('http://example.com/', function(err, res***REMOVED*** {
    if (err***REMOVED*** throw err;
    console.log('Done'***REMOVED***;
***REMOVED******REMOVED***;
}***REMOVED***;
```

For edge cases, like POST request to URL with query string or to pass HTTP auth credentials, object can be passed to `form.submit(***REMOVED***` as first parameter:

``` javascript
form.submit({
  host: 'example.com',
  path: '/probably.php?extra=params',
  auth: 'username:password'
}, function(err, res***REMOVED*** {
  console.log(res.statusCode***REMOVED***;
}***REMOVED***;
```

## Notes

- ```getLengthSync(***REMOVED***``` method DOESN'T calculate length for streams, use ```knownLength``` options as workaround.
- If it feels like FormData hangs after submit and you're on ```node-0.10```, please check [Compatibility with Older Node Versions][streams2-thing]

## TODO

- Add new streams (0.10***REMOVED*** support and try really hard not to break it for 0.8.x.

## License

Form-Data is licensed under the MIT license.
