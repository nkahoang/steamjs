var stringify = require('./stringify.js'***REMOVED***;

var circularObj = { a: 'b' };
circularObj.circularRef = circularObj;
circularObj.list = [ circularObj, circularObj ];

//////////
// default
var testObj = {
  "a": "b",
  "circularRef": "[Circular ~]",
  "list": [
    "[Circular ~]",
    "[Circular ~]"
  ]
};

var assert = require('assert'***REMOVED***;
assert.equal(JSON.stringify(testObj, null, 2***REMOVED***,
             stringify(circularObj, null, 2***REMOVED******REMOVED***;

assert.equal(JSON.stringify(testObj, null, 2***REMOVED***,
            JSON.stringify(circularObj, stringify.getSerialize(***REMOVED***, 2***REMOVED******REMOVED***;


////////
// prune
testObj = {
  "a": "b",
  "list": [
    null,
    null
  ]
};

function prune(k, v***REMOVED*** {}

assert.equal(JSON.stringify(testObj, null, 2***REMOVED***,
             stringify(circularObj, null, 2, prune***REMOVED******REMOVED***;

///////////
// re-cycle
// (throws***REMOVED***
function recycle(k, v***REMOVED*** {
  return v;
}

assert.throws(function(***REMOVED*** {
  stringify(circularObj, null, 2, recycle***REMOVED***;
}***REMOVED***;

////////
// fancy
testObj = {
  "a": "b",
  "circularRef": "circularRef{a:string,circularRef:Object,list:Array}",
  "list": [
    "0{a:string,circularRef:Object,list:Array}",
    "1{a:string,circularRef:Object,list:Array}"
  ]
};

function signer(key, value***REMOVED*** {
  var ret = key + '{';
  var f = false;
  for (var i in value***REMOVED*** {
    if (f***REMOVED***
      ret += ',';
    f = true;
    ret += i + ':';
    var v = value[i];
    switch (typeof v***REMOVED*** {
      case 'object':
        if (!v***REMOVED***
          ret += 'null';
        else if (Array.isArray(v***REMOVED******REMOVED***
          ret += 'Array'
        else
          ret += v.constructor && v.constructor.name || 'Object';
        break;
      default:
        ret += typeof v;
        break;
  ***REMOVED***
***REMOVED***
  ret += '}';
  return ret;
}

assert.equal(JSON.stringify(testObj, null, 2***REMOVED***,
             stringify(circularObj, null, 2, signer***REMOVED******REMOVED***;


///////
//multi
var a = { x: 1 };
a.a = a;
var b = { x: 2 };
b.a = a;

var c = { a: a, b: b };
var d = { list: [ a, b, c ] };
d.d = d;

var multi = {
  "list": [
    {
      "x": 1,
      "a": "[Circular ~.list.0]"
  ***REMOVED***,
    {
      "x": 2,
      "a": "[Circular ~.list.0]"
  ***REMOVED***,
    {
      "a": "[Circular ~.list.0]",
      "b": "[Circular ~.list.1]"
  ***REMOVED***
  ],
  "d": "[Circular ~]"
};

assert.equal(JSON.stringify(multi, null, 2***REMOVED***,
             stringify(d, null, 2***REMOVED******REMOVED***;

////////
// pass!
console.log('ok'***REMOVED***;
