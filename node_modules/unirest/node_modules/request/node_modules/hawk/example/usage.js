// Load modules

var Http = require('http'***REMOVED***;
var Request = require('request'***REMOVED***;
var Hawk = require('../lib'***REMOVED***;


// Declare internals

var internals = {
    credentials: {
        dh37fgj492je: {
            id: 'dh37fgj492je',                                             // Required by Hawk.client.header 
            key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',
            algorithm: 'sha256',
            user: 'Steve'
      ***REMOVED***
  ***REMOVED***
};


// Credentials lookup function

var credentialsFunc = function (id, callback***REMOVED*** {

    return callback(null, internals.credentials[id]***REMOVED***;
};


// Create HTTP server

var handler = function (req, res***REMOVED*** {

    Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials, artifacts***REMOVED*** {

        var payload = (!err ? 'Hello ' + credentials.user + ' ' + artifacts.ext : 'Shoosh!'***REMOVED***;
        var headers = {
            'Content-Type': 'text/plain',
            'Server-Authorization': Hawk.server.header(credentials, artifacts, { payload: payload, contentType: 'text/plain' }***REMOVED***
      ***REMOVED***;

        res.writeHead(!err ? 200 : 401, headers***REMOVED***;
        res.end(payload***REMOVED***;
  ***REMOVED******REMOVED***;
};

Http.createServer(handler***REMOVED***.listen(8000, '127.0.0.1'***REMOVED***;


// Send unauthenticated request

Request('http://127.0.0.1:8000/resource/1?b=1&a=2', function (error, response, body***REMOVED*** {

    console.log(response.statusCode + ': ' + body***REMOVED***;
}***REMOVED***;


// Send authenticated request

credentialsFunc('dh37fgj492je', function (err, credentials***REMOVED*** {

    var header = Hawk.client.header('http://127.0.0.1:8000/resource/1?b=1&a=2', 'GET', { credentials: credentials, ext: 'and welcome!' }***REMOVED***;
    var options = {
        uri: 'http://127.0.0.1:8000/resource/1?b=1&a=2',
        method: 'GET',
        headers: {
            authorization: header.field
      ***REMOVED***
  ***REMOVED***;

    Request(options, function (error, response, body***REMOVED*** {

        var isValid = Hawk.client.authenticate(response, credentials, header.artifacts, { payload: body }***REMOVED***;
        console.log(response.statusCode + ': ' + body + (isValid ? ' (valid***REMOVED***' : ' (invalid***REMOVED***'***REMOVED******REMOVED***;
        process.exit(0***REMOVED***;
  ***REMOVED******REMOVED***;
}***REMOVED***;

