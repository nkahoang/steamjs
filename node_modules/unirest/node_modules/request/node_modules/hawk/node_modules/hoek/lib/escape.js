// Declare internals

var internals = {};


exports.escapeJavaScript = function (input***REMOVED*** {

    if (!input***REMOVED*** {
        return '';
  ***REMOVED***

    var escaped = '';

    for (var i = 0, il = input.length; i < il; ++i***REMOVED*** {

        var charCode = input.charCodeAt(i***REMOVED***;

        if (internals.isSafe(charCode***REMOVED******REMOVED*** {
            escaped += input[i];
      ***REMOVED***
        else {
            escaped += internals.escapeJavaScriptChar(charCode***REMOVED***;
      ***REMOVED***
  ***REMOVED***

    return escaped;
};


exports.escapeHtml = function (input***REMOVED*** {

    if (!input***REMOVED*** {
        return '';
  ***REMOVED***

    var escaped = '';

    for (var i = 0, il = input.length; i < il; ++i***REMOVED*** {

        var charCode = input.charCodeAt(i***REMOVED***;

        if (internals.isSafe(charCode***REMOVED******REMOVED*** {
            escaped += input[i];
      ***REMOVED***
        else {
            escaped += internals.escapeHtmlChar(charCode***REMOVED***;
      ***REMOVED***
  ***REMOVED***

    return escaped;
};


internals.escapeJavaScriptChar = function (charCode***REMOVED*** {

    if (charCode >= 256***REMOVED*** {
        return '\\u' + internals.padLeft('' + charCode, 4***REMOVED***;
  ***REMOVED***

    var hexValue = new Buffer(String.fromCharCode(charCode***REMOVED***, 'ascii'***REMOVED***.toString('hex'***REMOVED***;
    return '\\x' + internals.padLeft(hexValue, 2***REMOVED***;
};


internals.escapeHtmlChar = function (charCode***REMOVED*** {

    var namedEscape = internals.namedHtml[charCode];
    if (typeof namedEscape !== 'undefined'***REMOVED*** {
        return namedEscape;
  ***REMOVED***

    if (charCode >= 256***REMOVED*** {
        return '&#' + charCode + ';';
  ***REMOVED***

    var hexValue = new Buffer(String.fromCharCode(charCode***REMOVED***, 'ascii'***REMOVED***.toString('hex'***REMOVED***;
    return '&#x' + internals.padLeft(hexValue, 2***REMOVED*** + ';';
};


internals.padLeft = function (str, len***REMOVED*** {

    while (str.length < len***REMOVED*** {
        str = '0' + str;
  ***REMOVED***

    return str;
};


internals.isSafe = function (charCode***REMOVED*** {

    return (typeof internals.safeCharCodes[charCode] !== 'undefined'***REMOVED***;
};


internals.namedHtml = {
    '38': '&amp;',
    '60': '&lt;',
    '62': '&gt;',
    '34': '&quot;',
    '160': '&nbsp;',
    '162': '&cent;',
    '163': '&pound;',
    '164': '&curren;',
    '169': '&copy;',
    '174': '&reg;'
};


internals.safeCharCodes = (function (***REMOVED*** {

    var safe = {};

    for (var i = 32; i < 123; ++i***REMOVED*** {

        if ((i >= 97 && i <= 122***REMOVED*** ||         // a-z
            (i >= 65 && i <= 90***REMOVED*** ||          // A-Z
            (i >= 48 && i <= 57***REMOVED*** ||          // 0-9
            i === 32 ||                      // space
            i === 46 ||                      // .
            i === 44 ||                      // ,
            i === 45 ||                      // -
            i === 58 ||                      // :
            i === 95***REMOVED*** {                      // _

            safe[i] = null;
      ***REMOVED***
  ***REMOVED***

    return safe;
}(***REMOVED******REMOVED***;