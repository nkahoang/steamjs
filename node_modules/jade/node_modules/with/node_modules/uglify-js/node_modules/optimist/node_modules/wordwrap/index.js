var wordwrap = module.exports = function (start, stop, params***REMOVED*** {
    if (typeof start === 'object'***REMOVED*** {
        params = start;
        start = params.start;
        stop = params.stop;
  ***REMOVED***
    
    if (typeof stop === 'object'***REMOVED*** {
        params = stop;
        start = start || params.start;
        stop = undefined;
  ***REMOVED***
    
    if (!stop***REMOVED*** {
        stop = start;
        start = 0;
  ***REMOVED***
    
    if (!params***REMOVED*** params = {};
    var mode = params.mode || 'soft';
    var re = mode === 'hard' ? /\b/ : /(\S+\s+***REMOVED***/;
    
    return function (text***REMOVED*** {
        var chunks = text.toString(***REMOVED***
            .split(re***REMOVED***
            .reduce(function (acc, x***REMOVED*** {
                if (mode === 'hard'***REMOVED*** {
                    for (var i = 0; i < x.length; i += stop - start***REMOVED*** {
                        acc.push(x.slice(i, i + stop - start***REMOVED******REMOVED***;
                  ***REMOVED***
              ***REMOVED***
                else acc.push(x***REMOVED***
                return acc;
          ***REMOVED***, []***REMOVED***
        ;
        
        return chunks.reduce(function (lines, rawChunk***REMOVED*** {
            if (rawChunk === ''***REMOVED*** return lines;
            
            var chunk = rawChunk.replace(/\t/g, '    '***REMOVED***;
            
            var i = lines.length - 1;
            if (lines[i].length + chunk.length > stop***REMOVED*** {
                lines[i] = lines[i].replace(/\s+$/, ''***REMOVED***;
                
                chunk.split(/\n/***REMOVED***.forEach(function (c***REMOVED*** {
                    lines.push(
                        new Array(start + 1***REMOVED***.join(' '***REMOVED***
                        + c.replace(/^\s+/, ''***REMOVED***
                    ***REMOVED***;
              ***REMOVED******REMOVED***;
          ***REMOVED***
            else if (chunk.match(/\n/***REMOVED******REMOVED*** {
                var xs = chunk.split(/\n/***REMOVED***;
                lines[i] += xs.shift(***REMOVED***;
                xs.forEach(function (c***REMOVED*** {
                    lines.push(
                        new Array(start + 1***REMOVED***.join(' '***REMOVED***
                        + c.replace(/^\s+/, ''***REMOVED***
                    ***REMOVED***;
              ***REMOVED******REMOVED***;
          ***REMOVED***
            else {
                lines[i] += chunk;
          ***REMOVED***
            
            return lines;
      ***REMOVED***, [ new Array(start + 1***REMOVED***.join(' '***REMOVED*** ]***REMOVED***.join('\n'***REMOVED***;
  ***REMOVED***;
};

wordwrap.soft = wordwrap;

wordwrap.hard = function (start, stop***REMOVED*** {
    return wordwrap(start, stop, { mode : 'hard' }***REMOVED***;
};
