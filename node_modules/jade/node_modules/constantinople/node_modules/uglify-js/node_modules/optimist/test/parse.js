var optimist = require('../index'***REMOVED***;
var ***REMOVED***;
var test = require('tap'***REMOVED***.test;

var $0 = 'node ./' + path.relative(process.cwd(***REMOVED***, __filename***REMOVED***;

test('short boolean', function (t***REMOVED*** {
    var parse = optimist.parse([ '-b' ]***REMOVED***;
    t.same(parse, { b : true, _ : [], $0 : $0 }***REMOVED***;
    t.same(typeof parse.b, 'boolean'***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('long boolean', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '--bool' ]***REMOVED***,
        { bool : true, _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;
    
test('bare', function (t***REMOVED*** {
    t.same(
        optimist.parse([ 'foo', 'bar', 'baz' ]***REMOVED***,
        { _ : [ 'foo', 'bar', 'baz' ], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('short group', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '-cats' ]***REMOVED***,
        { c : true, a : true, t : true, s : true, _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('short group next', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '-cats', 'meow' ]***REMOVED***,
        { c : true, a : true, t : true, s : 'meow', _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;
 
test('short capture', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '-h', 'localhost' ]***REMOVED***,
        { h : 'localhost', _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('short captures', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '-h', 'localhost', '-p', '555' ]***REMOVED***,
        { h : 'localhost', p : 555, _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('long capture sp', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '--pow', 'xixxle' ]***REMOVED***,
        { pow : 'xixxle', _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('long capture eq', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '--pow=xixxle' ]***REMOVED***,
        { pow : 'xixxle', _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***
}***REMOVED***;

test('long captures sp', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '--host', 'localhost', '--port', '555' ]***REMOVED***,
        { host : 'localhost', port : 555, _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('long captures eq', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '--host=localhost', '--port=555' ]***REMOVED***,
        { host : 'localhost', port : 555, _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('mixed short bool and capture', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '-h', 'localhost', '-fp', '555', 'script.js' ]***REMOVED***,
        {
            f : true, p : 555, h : 'localhost',
            _ : [ 'script.js' ], $0 : $0,
      ***REMOVED***
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;
 
test('short and long', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '-h', 'localhost', '-fp', '555', 'script.js' ]***REMOVED***,
        {
            f : true, p : 555, h : 'localhost',
            _ : [ 'script.js' ], $0 : $0,
      ***REMOVED***
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('no', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '--no-moo' ]***REMOVED***,
        { moo : false, _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;
 
test('multi', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '-v', 'a', '-v', 'b', '-v', 'c' ]***REMOVED***,
        { v : ['a','b','c'], _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;
 
test('comprehensive', function (t***REMOVED*** {
    t.same(
        optimist.parse([
            '--name=meowmers', 'bare', '-cats', 'woo',
            '-h', 'awesome', '--multi=quux',
            '--key', 'value',
            '-b', '--bool', '--no-meep', '--multi=baz',
            '--', '--not-a-flag', 'eek'
        ]***REMOVED***,
        {
            c : true,
            a : true,
            t : true,
            s : 'woo',
            h : 'awesome',
            b : true,
            bool : true,
            key : 'value',
            multi : [ 'quux', 'baz' ],
            meep : false,
            name : 'meowmers',
            _ : [ 'bare', '--not-a-flag', 'eek' ],
            $0 : $0
      ***REMOVED***
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('nums', function (t***REMOVED*** {
    var argv = optimist.parse([
        '-x', '1234',
        '-y', '5.67',
        '-z', '1e7',
        '-w', '10f',
        '--hex', '0xdeadbeef',
        '789',
    ]***REMOVED***;
    t.same(argv, {
        x : 1234,
        y : 5.67,
        z : 1e7,
        w : '10f',
        hex : 0xdeadbeef,
        _ : [ 789 ],
        $0 : $0
  ***REMOVED******REMOVED***;
    t.same(typeof argv.x, 'number'***REMOVED***;
    t.same(typeof argv.y, 'number'***REMOVED***;
    t.same(typeof argv.z, 'number'***REMOVED***;
    t.same(typeof argv.w, 'string'***REMOVED***;
    t.same(typeof argv.hex, 'number'***REMOVED***;
    t.same(typeof argv._[0], 'number'***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('flag boolean', function (t***REMOVED*** {
    var parse = optimist([ '-t', 'moo' ]***REMOVED***.boolean(['t']***REMOVED***.argv;
    t.same(parse, { t : true, _ : [ 'moo' ], $0 : $0 }***REMOVED***;
    t.same(typeof parse.t, 'boolean'***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('flag boolean value', function (t***REMOVED*** {
    var parse = optimist(['--verbose', 'false', 'moo', '-t', 'true']***REMOVED***
        .boolean(['t', 'verbose']***REMOVED***.default('verbose', true***REMOVED***.argv;
    
    t.same(parse, {
        verbose: false,
        t: true,
        _: ['moo'],
        $0 : $0
  ***REMOVED******REMOVED***;
    
    t.same(typeof parse.verbose, 'boolean'***REMOVED***;
    t.same(typeof parse.t, 'boolean'***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('flag boolean default false', function (t***REMOVED*** {
    var parse = optimist(['moo']***REMOVED***
        .boolean(['t', 'verbose']***REMOVED***
        .default('verbose', false***REMOVED***
        .default('t', false***REMOVED***.argv;
    
    t.same(parse, {
        verbose: false,
        t: false,
        _: ['moo'],
        $0 : $0
  ***REMOVED******REMOVED***;
    
    t.same(typeof parse.verbose, 'boolean'***REMOVED***;
    t.same(typeof parse.t, 'boolean'***REMOVED***;
    t.end(***REMOVED***;

}***REMOVED***;

test('boolean groups', function (t***REMOVED*** {
    var parse = optimist([ '-x', '-z', 'one', 'two', 'three' ]***REMOVED***
        .boolean(['x','y','z']***REMOVED***.argv;
    
    t.same(parse, {
        x : true,
        y : false,
        z : true,
        _ : [ 'one', 'two', 'three' ],
        $0 : $0
  ***REMOVED******REMOVED***;
    
    t.same(typeof parse.x, 'boolean'***REMOVED***;
    t.same(typeof parse.y, 'boolean'***REMOVED***;
    t.same(typeof parse.z, 'boolean'***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('newlines in params' , function (t***REMOVED*** {
    var args = optimist.parse([ '-s', "X\nX" ]***REMOVED***
    t.same(args, { _ : [], s : "X\nX", $0 : $0 }***REMOVED***;

    // reproduce in bash:
    // VALUE="new
    // line"
    // node program.js --s="$VALUE"
    args = optimist.parse([ "--s=X\nX" ]***REMOVED***
    t.same(args, { _ : [], s : "X\nX", $0 : $0 }***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('strings' , function (t***REMOVED*** {
    var s = optimist([ '-s', '0001234' ]***REMOVED***.string('s'***REMOVED***.argv.s;
    t.same(s, '0001234'***REMOVED***;
    t.same(typeof s, 'string'***REMOVED***;
    
    var x = optimist([ '-x', '56' ]***REMOVED***.string('x'***REMOVED***.argv.x;
    t.same(x, '56'***REMOVED***;
    t.same(typeof x, 'string'***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('stringArgs', function (t***REMOVED*** {
    var s = optimist([ '  ', '  ' ]***REMOVED***.string('_'***REMOVED***.argv._;
    t.same(s.length, 2***REMOVED***;
    t.same(typeof s[0], 'string'***REMOVED***;
    t.same(s[0], '  '***REMOVED***;
    t.same(typeof s[1], 'string'***REMOVED***;
    t.same(s[1], '  '***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('slashBreak', function (t***REMOVED*** {
    t.same(
        optimist.parse([ '-I/foo/bar/baz' ]***REMOVED***,
        { I : '/foo/bar/baz', _ : [], $0 : $0 }
    ***REMOVED***;
    t.same(
        optimist.parse([ '-xyz/foo/bar/baz' ]***REMOVED***,
        { x : true, y : true, z : '/foo/bar/baz', _ : [], $0 : $0 }
    ***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('alias', function (t***REMOVED*** {
    var argv = optimist([ '-f', '11', '--zoom', '55' ]***REMOVED***
        .alias('z', 'zoom'***REMOVED***
        .argv
    ;
    t.equal(argv.zoom, 55***REMOVED***;
    t.equal(argv.z, argv.zoom***REMOVED***;
    t.equal(argv.f, 11***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('multiAlias', function (t***REMOVED*** {
    var argv = optimist([ '-f', '11', '--zoom', '55' ]***REMOVED***
        .alias('z', [ 'zm', 'zoom' ]***REMOVED***
        .argv
    ;
    t.equal(argv.zoom, 55***REMOVED***;
    t.equal(argv.z, argv.zoom***REMOVED***;
    t.equal(argv.z, argv.zm***REMOVED***;
    t.equal(argv.f, 11***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('boolean default true', function (t***REMOVED*** {
    var argv = optimist.options({
        sometrue: {
            boolean: true,
            default: true
      ***REMOVED***
  ***REMOVED******REMOVED***.argv;
  
    t.equal(argv.sometrue, true***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('boolean default false', function (t***REMOVED*** {
    var argv = optimist.options({
        somefalse: {
            boolean: true,
            default: false
      ***REMOVED***
  ***REMOVED******REMOVED***.argv;

    t.equal(argv.somefalse, false***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('nested dotted objects', function (t***REMOVED*** {
    var argv = optimist([
        '--foo.bar', '3', '--foo.baz', '4',
        '--foo.quux.quibble', '5', '--foo.quux.o_O',
        '--beep.boop'
    ]***REMOVED***.argv;
    
    t.same(argv.foo, {
        bar : 3,
        baz : 4,
        quux : {
            quibble : 5,
            o_O : true
      ***REMOVED***,
  ***REMOVED******REMOVED***;
    t.same(argv.beep, { boop : true }***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;

test('boolean and alias with chainable api', function (t***REMOVED*** {
    var aliased = [ '-h', 'derp' ];
    var regular = [ '--herp',  'derp' ];
    var opts = {
        herp: { alias: 'h', boolean: true }
  ***REMOVED***;
    var aliasedArgv = optimist(aliased***REMOVED***
        .boolean('herp'***REMOVED***
        .alias('h', 'herp'***REMOVED***
        .argv;
    var propertyArgv = optimist(regular***REMOVED***
        .boolean('herp'***REMOVED***
        .alias('h', 'herp'***REMOVED***
        .argv;
    var expected = {
        herp: true,
        h: true,
        '_': [ 'derp' ],
        '$0': $0,
  ***REMOVED***;

    t.same(aliasedArgv, expected***REMOVED***;
    t.same(propertyArgv, expected***REMOVED***; 
    t.end(***REMOVED***;
}***REMOVED***;

test('boolean and alias with options hash', function (t***REMOVED*** {
    var aliased = [ '-h', 'derp' ];
    var regular = [ '--herp', 'derp' ];
    var opts = {
        herp: { alias: 'h', boolean: true }
  ***REMOVED***;
    var aliasedArgv = optimist(aliased***REMOVED***
      .options(opts***REMOVED***
      .argv;
    var propertyArgv = optimist(regular***REMOVED***.options(opts***REMOVED***.argv;
    var expected = {
        herp: true,
        h: true,
        '_': [ 'derp' ],
        '$0': $0,
  ***REMOVED***;

    t.same(aliasedArgv, expected***REMOVED***;
    t.same(propertyArgv, expected***REMOVED***;

    t.end(***REMOVED***;
}***REMOVED***;

test('boolean and alias using explicit true', function (t***REMOVED*** {
    var aliased = [ '-h', 'true' ];
    var regular = [ '--herp',  'true' ];
    var opts = {
        herp: { alias: 'h', boolean: true }
  ***REMOVED***;
    var aliasedArgv = optimist(aliased***REMOVED***
        .boolean('h'***REMOVED***
        .alias('h', 'herp'***REMOVED***
        .argv;
    var propertyArgv = optimist(regular***REMOVED***
        .boolean('h'***REMOVED***
        .alias('h', 'herp'***REMOVED***
        .argv;
    var expected = {
        herp: true,
        h: true,
        '_': [ ],
        '$0': $0,
  ***REMOVED***;

    t.same(aliasedArgv, expected***REMOVED***;
    t.same(propertyArgv, expected***REMOVED***; 
    t.end(***REMOVED***;
}***REMOVED***;

// regression, see https://github.com/substack/node-optimist/issues/71
test('boolean and --x=true', function(t***REMOVED*** {
    var parsed = optimist(['--boool', '--other=true']***REMOVED***.boolean('boool'***REMOVED***.argv;

    t.same(parsed.boool, true***REMOVED***;
    t.same(parsed.other, 'true'***REMOVED***;

    parsed = optimist(['--boool', '--other=false']***REMOVED***.boolean('boool'***REMOVED***.argv;

    t.same(parsed.boool, true***REMOVED***;
    t.same(parsed.other, 'false'***REMOVED***;
    t.end(***REMOVED***;
}***REMOVED***;
