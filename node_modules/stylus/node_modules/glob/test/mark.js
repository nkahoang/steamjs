var test = require("tap"***REMOVED***.test
var glob = require('../'***REMOVED***
process.chdir(__dirname***REMOVED***

// expose timing issues
var lag = 5
glob.Glob.prototype._stat = function(o***REMOVED*** { return function(f, cb***REMOVED*** {
  var args = arguments
  setTimeout(function(***REMOVED*** {
    o.call(this, f, cb***REMOVED***
***REMOVED***.bind(this***REMOVED***, lag += 5***REMOVED***
}}(glob.Glob.prototype._stat***REMOVED***


test("mark, with **", function (t***REMOVED*** {
  glob("a/*b*/**", {mark: true}, function (er, results***REMOVED*** {
    if (er***REMOVED***
      throw er
    var expect =
      [ 'a/abcdef/',
        'a/abcdef/g/',
        'a/abcdef/g/h',
        'a/abcfed/',
        'a/abcfed/g/',
        'a/abcfed/g/h',
        'a/b/',
        'a/b/c/',
        'a/b/c/d',
        'a/bc/',
        'a/bc/e/',
        'a/bc/e/f',
        'a/cb/',
        'a/cb/e/',
        'a/cb/e/f' ]

    t.same(results, expect***REMOVED***
    t.end(***REMOVED***
***REMOVED******REMOVED***
}***REMOVED***

test("mark, no / on pattern", function (t***REMOVED*** {
  glob("a/*", {mark: true}, function (er, results***REMOVED*** {
    if (er***REMOVED***
      throw er
    var expect = [ 'a/abcdef/',
                   'a/abcfed/',
                   'a/b/',
                   'a/bc/',
                   'a/c/',
                   'a/cb/' ]

    if (process.platform !== "win32"***REMOVED***
      expect.push('a/symlink/'***REMOVED***

    t.same(results, expect***REMOVED***
    t.end(***REMOVED***
***REMOVED******REMOVED***.on('match', function(m***REMOVED*** {
    t.similar(m, /\/$/***REMOVED***
***REMOVED******REMOVED***
}***REMOVED***

test("mark=false, no / on pattern", function (t***REMOVED*** {
  glob("a/*", function (er, results***REMOVED*** {
    if (er***REMOVED***
      throw er
    var expect = [ 'a/abcdef',
                   'a/abcfed',
                   'a/b',
                   'a/bc',
                   'a/c',
                   'a/cb' ]

    if (process.platform !== "win32"***REMOVED***
      expect.push('a/symlink'***REMOVED***
    t.same(results, expect***REMOVED***
    t.end(***REMOVED***
***REMOVED******REMOVED***.on('match', function(m***REMOVED*** {
    t.similar(m, /[^\/]$/***REMOVED***
***REMOVED******REMOVED***
}***REMOVED***

test("mark=true, / on pattern", function (t***REMOVED*** {
  glob("a/*/", {mark: true}, function (er, results***REMOVED*** {
    if (er***REMOVED***
      throw er
    var expect = [ 'a/abcdef/',
                    'a/abcfed/',
                    'a/b/',
                    'a/bc/',
                    'a/c/',
                    'a/cb/' ]
    if (process.platform !== "win32"***REMOVED***
      expect.push('a/symlink/'***REMOVED***
    t.same(results, expect***REMOVED***
    t.end(***REMOVED***
***REMOVED******REMOVED***.on('match', function(m***REMOVED*** {
    t.similar(m, /\/$/***REMOVED***
***REMOVED******REMOVED***
}***REMOVED***

test("mark=false, / on pattern", function (t***REMOVED*** {
  glob("a/*/", function (er, results***REMOVED*** {
    if (er***REMOVED***
      throw er
    var expect = [ 'a/abcdef/',
                   'a/abcfed/',
                   'a/b/',
                   'a/bc/',
                   'a/c/',
                   'a/cb/' ]
    if (process.platform !== "win32"***REMOVED***
      expect.push('a/symlink/'***REMOVED***
    t.same(results, expect***REMOVED***
    t.end(***REMOVED***
***REMOVED******REMOVED***.on('match', function(m***REMOVED*** {
    t.similar(m, /\/$/***REMOVED***
***REMOVED******REMOVED***
}***REMOVED***
