var assert = require('assert'***REMOVED***;
var ***REMOVED***;
var net = require('net'***REMOVED***;
var multiparty = require('../../'***REMOVED***;

var server = http.createServer(function (req, res***REMOVED*** {
  var form = new multiparty.Form(***REMOVED***;
  var aborted_received = false;
  form.on('aborted', function (***REMOVED*** {
    aborted_received = true;
***REMOVED******REMOVED***;
  form.on('error', function (***REMOVED*** {
    assert(aborted_received, 'Error event should follow aborted'***REMOVED***;
    server.close(***REMOVED***;
***REMOVED******REMOVED***;
  form.on('end', function (***REMOVED*** {
    throw new Error('Unexpected "end" event'***REMOVED***;
***REMOVED******REMOVED***;
  form.parse(req***REMOVED***;
}***REMOVED***.listen(0, 'localhost', function (***REMOVED*** {
  var client = net.connect(server.address(***REMOVED***.port***REMOVED***;
  client.write(
    "POST / HTTP/1.1\r\n" +
    "Content-Length: 70\r\n" +
    "Content-Type: multipart/form-data; boundary=foo\r\n\r\n"***REMOVED***;
  client.end(***REMOVED***;
}***REMOVED***;
