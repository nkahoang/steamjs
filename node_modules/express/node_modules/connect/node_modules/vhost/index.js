
/*!
 * Connect - vhost
 * Copyright(c***REMOVED*** 2010 Sencha Inc.
 * Copyright(c***REMOVED*** 2011 TJ Holowaychuk
 * MIT Licensed
 */

/**
 * Vhost:
 *
 *   Setup vhost for the given `hostname` and `server`.
 *
 *     connect(***REMOVED***
 *       .use(connect.vhost('foo.com', fooApp***REMOVED******REMOVED***
 *       .use(connect.vhost('bar.com', barApp***REMOVED******REMOVED***
 *       .use(connect.vhost('*.com', mainApp***REMOVED******REMOVED***
 *
 *  The `server` may be a Connect server or
 *  a regular Node `http.Server`.
 *
 * @param {String} hostname
 * @param {Server} server
 * @return {Function}
 * @api public
 */

module.exports = function vhost(hostname, server***REMOVED***{
  if (!hostname***REMOVED*** throw new Error('vhost hostname required'***REMOVED***;
  if (!server***REMOVED*** throw new Error('vhost server required'***REMOVED***;
  var regexp = new RegExp('^' + hostname.replace(/[^*\w]/g, '\\$&'***REMOVED***.replace(/[*]/g, '(?:.*?***REMOVED***'***REMOVED***  + '$', 'i'***REMOVED***;
  if (server.onvhost***REMOVED*** server.onvhost(hostname***REMOVED***;
  return function vhost(req, res, next***REMOVED***{
    if (!req.headers.host***REMOVED*** return next(***REMOVED***;
    var host = req.headers.host.split(':'***REMOVED***[0];
    if (!regexp.test(host***REMOVED******REMOVED*** return next(***REMOVED***;
    if ('function' == typeof server***REMOVED*** return server(req, res, next***REMOVED***;
    server.emit('request', req, res***REMOVED***;
***REMOVED***;
};
