/*!
 * Connect - methodOverride
 * Copyright(c***REMOVED*** 2010 Sencha Inc.
 * Copyright(c***REMOVED*** 2011 TJ Holowaychuk
 * MIT Licensed
 */

/**
 * Module dependencies.
 */

var methods = require('methods'***REMOVED***;

/**
 * Method Override:
 *
 * Provides faux HTTP method support.
 *
 * Pass an optional `key` to use when checking for
 * a method override, otherwise defaults to _\_method_.
 * The original method is available via `req.originalMethod`.
 *
 * @param {String} key
 * @return {Function}
 * @api public
 */

module.exports = function methodOverride(key***REMOVED***{
  key = key || "_method";
  return function methodOverride(req, res, next***REMOVED*** {
    var method;
    req.originalMethod = req.originalMethod || req.method;

    // req.body
    if (req.body && typeof req.body === 'object' && key in req.body***REMOVED*** {
      method = req.body[key].toLowerCase(***REMOVED***;
      delete req.body[key];
  ***REMOVED***

    // check X-HTTP-Method-Override
    if (req.headers['x-http-method-override']***REMOVED*** {
      method = req.headers['x-http-method-override'].toLowerCase(***REMOVED***;
  ***REMOVED***

    // replace
    if (supports(method***REMOVED******REMOVED*** req.method = method.toUpperCase(***REMOVED***;

    next(***REMOVED***;
***REMOVED***;
};

/**
 * Check if node supports `method`.
 */

function supports(method***REMOVED*** {
  return ~methods.indexOf(method***REMOVED***;
}
