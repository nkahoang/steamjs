var cookie = require('cookie'***REMOVED***;
var parse = require('./lib/parse'***REMOVED***;

/**
 * Parse _Cookie_ header and populate `req.cookies`
 * with an object keyed by the cookie names. Optionally
 * you may enabled signed cookie support by passing
 * a `secret` string, which assigns `req.secret` so
 * it may be used by other middleware.
 *
 * Examples:
 *
 *     connect(***REMOVED***
 *       .use(connect.cookieParser('optional secret string'***REMOVED******REMOVED***
 *       .use(function(req, res, next***REMOVED***{
 *         res.end(JSON.stringify(req.cookies***REMOVED******REMOVED***;
 *     ***REMOVED******REMOVED***
 *
 * @param {String} secret
 * @return {Function}
 * @api public
 */

module.exports = function cookieParser(secret, opt***REMOVED***{
  return function cookieParser(req, res, next***REMOVED*** {
    if (req.cookies***REMOVED*** return next(***REMOVED***;
    var cookies = req.headers.cookie;

    req.secret = secret;
    req.cookies = {};
    req.signedCookies = {};

    if (cookies***REMOVED*** {
      try {
        req.cookies = cookie.parse(cookies, opt***REMOVED***;
        if (secret***REMOVED*** {
          req.signedCookies = parse.signedCookies(req.cookies, secret***REMOVED***;
          req.signedCookies = parse.JSONCookies(req.signedCookies***REMOVED***;
      ***REMOVED***
        req.cookies = parse.JSONCookies(req.cookies***REMOVED***;
    ***REMOVED*** catch (err***REMOVED*** {
        err.status = 400;
        return next(err***REMOVED***;
    ***REMOVED***
  ***REMOVED***
    next(***REMOVED***;
***REMOVED***;
};
