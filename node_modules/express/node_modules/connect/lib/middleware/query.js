/*!
 * Connect - query
 * Copyright(c***REMOVED*** 2011 TJ Holowaychuk
 * Copyright(c***REMOVED*** 2011 Sencha Inc.
 * MIT Licensed
 */

/**
 * Module dependencies.
 */

var qs = require('qs'***REMOVED***
  , parse = require('../utils'***REMOVED***.parseUrl;

/**
 * Query:
 *
 * Automatically parse the query-string when available,
 * populating the `req.query` object using
 * [qs](https://github.com/visionmedia/node-querystring***REMOVED***.
 *
 * Examples:
 *
 *     connect(***REMOVED***
 *       .use(connect.query(***REMOVED******REMOVED***
 *       .use(function(req, res***REMOVED***{
 *         res.end(JSON.stringify(req.query***REMOVED******REMOVED***;
 *     ***REMOVED******REMOVED***;
 *
 *  The `options` passed are provided to qs.parse function.
 *
 * @param {Object} options
 * @return {Function}
 * @api public
 */

module.exports = function query(options***REMOVED***{
  return function query(req, res, next***REMOVED***{
    if (!req.query***REMOVED*** {
      req.query = ~req.url.indexOf('?'***REMOVED***
        ? qs.parse(parse(req***REMOVED***.query, options***REMOVED***
        : {};
  ***REMOVED***

    next(***REMOVED***;
***REMOVED***;
};
