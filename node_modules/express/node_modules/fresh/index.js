
/**
 * Expose `fresh(***REMOVED***`.
 */

module.exports = fresh;

/**
 * Check freshness of `req` and `res` headers.
 *
 * When the cache is "fresh" __true__ is returned,
 * otherwise __false__ is returned to indicate that
 * the cache is now stale.
 *
 * @param {Object} req
 * @param {Object} res
 * @return {Boolean}
 * @api public
 */

function fresh(req, res***REMOVED*** {
  // defaults
  var etagMatches = true;
  var notModified = true;

  // fields
  var modifiedSince = req['if-modified-since'];
  var noneMatch = req['if-none-match'];
  var lastModified = res['last-modified'];
  var etag = res['etag'];
  var cc = req['cache-control'];

  // unconditional request
  if (!modifiedSince && !noneMatch***REMOVED*** return false;

  // check for no-cache cache request directive
  if (cc && cc.indexOf('no-cache'***REMOVED*** !== -1***REMOVED*** return false;  

  // parse if-none-match
  if (noneMatch***REMOVED*** noneMatch = noneMatch.split(/ *, */***REMOVED***;

  // if-none-match
  if (noneMatch***REMOVED*** etagMatches = ~noneMatch.indexOf(etag***REMOVED*** || '*' == noneMatch[0];

  // if-modified-since
  if (modifiedSince***REMOVED*** {
    modifiedSince = new Date(modifiedSince***REMOVED***;
    lastModified = new Date(lastModified***REMOVED***;
    notModified = lastModified <= modifiedSince;
***REMOVED***

  return !! (etagMatches && notModified***REMOVED***;
}