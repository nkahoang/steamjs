var msgpack = require('node-msgpack'***REMOVED***;
var bison = require('bison'***REMOVED***;
var codec = {
	JSON: {
		encode: JSON.stringify,
		decode: JSON.parse
	},
	msgpack: {
		encode: msgpack.pack,
		decode: msgpack.unpack
	},
	bison: bison
};

var obj, l;

var s = '0';
for (var i = 0; i < 12; ++i***REMOVED*** s += s;

obj = {
	foo: s,
	arrrrrr: [{a:1,b:false,c:null,d:1.0}, 1111, 2222, 33333333],
	rand: [],
	a: s,
	ccc: s,
	b: s + s + s
};
for (i = 0; i < 100; ++i***REMOVED*** obj.rand.push(Math.random(***REMOVED******REMOVED***;
forObj(obj***REMOVED***;

obj = {
	foo: s,
	arrrrrr: [{a:1,b:false,c:null,d:1.0}, 1111, 2222, 33333333],
	rand: []
};
for (i = 0; i < 100; ++i***REMOVED*** obj.rand.push(Math.random(***REMOVED******REMOVED***;
forObj(obj***REMOVED***;

obj = {
	foo: s,
	arrrrrr: [{a:1,b:false,c:null,d:1.0}, 1111, 2222, 33333333],
	rand: []
};
forObj(obj***REMOVED***;

obj = {
	arrrrrr: [{a:1,b:false,c:null,d:1.0}, 1111, 2222, 33333333],
	rand: []
};
forObj(obj***REMOVED***;

function run(obj, codec***REMOVED*** {
	var t1 = Date.now(***REMOVED***;
	var n = 10000;
	for (var i = 0; i < n; ++i***REMOVED*** {
		codec.decode(l = codec.encode(obj***REMOVED******REMOVED***;
	}
	var t2 = Date.now(***REMOVED***;
	//console.log('DONE', n*1000/(t2-t1***REMOVED***, 'codecs/sec, length=', l.length***REMOVED***;
	return [n*1000/(t2-t1***REMOVED***, l.length];
}

function series(obj, cname, n***REMOVED*** {
	var rate = 0;
	var len = 0;
	for (var i = 0; i < n; ++i***REMOVED*** {
		var r = run(obj, codec[cname]***REMOVED***;
		rate += r[0];
		len += r[1];
	}
	rate /= n;
	len /= n;
	console.log(cname + '	' + rate + '	' + len***REMOVED***;
	return [rate, len];
}

function forObj(obj***REMOVED*** {
	var r = {
		JSON: series(obj, 'JSON', 20***REMOVED***,
		msgpack: series(obj, 'msgpack', 20***REMOVED***,
		bison: series(obj, 'bison', 20***REMOVED***
	};
	return r;
}
