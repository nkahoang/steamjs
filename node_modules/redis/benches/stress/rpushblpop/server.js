'use strict';

var freemem = require('os'***REMOVED***.freemem;
var codec = require('../codec'***REMOVED***;

var id = Math.random(***REMOVED***;
var recv = 0;

var cmd = require('redis'***REMOVED***.createClient(***REMOVED***;
var sub = require('redis'***REMOVED***.createClient(***REMOVED***
	.on('ready', function(***REMOVED*** {
		this.emit('timeline'***REMOVED***;
	}***REMOVED***
	.on('timeline', function(***REMOVED*** {
		var self = this;
		this.blpop('timeline', 0, function(err, result***REMOVED*** {
			var message = result[1];
			if (message***REMOVED*** {
				message = codec.decode(message***REMOVED***;
				++recv;
			}
			self.emit('timeline'***REMOVED***;
		}***REMOVED***;
	}***REMOVED***;

setInterval(function(***REMOVED*** {
	cmd.llen('timeline', function(err, result***REMOVED*** {
		console.error('id', id, 'received', recv, 'free', freemem(***REMOVED***, 'llen', result***REMOVED***;
	}***REMOVED***;
}, 2000***REMOVED***;
