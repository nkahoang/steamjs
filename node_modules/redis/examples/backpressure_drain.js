var redis = require("../index"***REMOVED***,
    client = redis.createClient(null, null, {
        command_queue_high_water: 5,
        command_queue_low_water: 1
  ***REMOVED******REMOVED***,
    remaining_ops = 100000, paused = false;

function op(***REMOVED*** {
    if (remaining_ops <= 0***REMOVED*** {
        console.error("Finished."***REMOVED***;
        process.exit(0***REMOVED***;
  ***REMOVED***

    remaining_ops--;
    if (client.hset("test hash", "val " + remaining_ops, remaining_ops***REMOVED*** === false***REMOVED*** {
        console.log("Pausing at " + remaining_ops***REMOVED***;
        paused = true;
  ***REMOVED*** else {
        process.nextTick(op***REMOVED***;
  ***REMOVED***
}

client.on("drain", function (***REMOVED*** {
    if (paused***REMOVED*** {
        console.log("Resuming at " + remaining_ops***REMOVED***;
        paused = false;
        process.nextTick(op***REMOVED***;
  ***REMOVED*** else {
        console.log("Got drain while not paused at " + remaining_ops***REMOVED***;
  ***REMOVED***
}***REMOVED***;

op(***REMOVED***;
