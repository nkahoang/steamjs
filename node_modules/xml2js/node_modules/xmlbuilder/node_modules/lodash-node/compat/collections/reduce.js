/**
 * Lo-Dash 2.4.1 (Custom Build***REMOVED*** <http://lodash.com/>
 * Build: `lodash modularize exports="node" -o ./compat/`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */
var baseEach = require('../internals/baseEach'***REMOVED***,
    createCallback = require('../functions/createCallback'***REMOVED***,
    isArray = require('../objects/isArray'***REMOVED***;

/**
 * Reduces a collection to a value which is the accumulated result of running
 * each element in the collection through the callback, where each successive
 * callback execution consumes the return value of the previous execution. If
 * `accumulator` is not provided the first element of the collection will be
 * used as the initial `accumulator` value. The callback is bound to `thisArg`
 * and invoked with four arguments; (accumulator, value, index|key, collection***REMOVED***.
 *
 * @static
 * @memberOf _
 * @alias foldl, inject
 * @category Collections
 * @param {Array|Object|string} collection The collection to iterate over.
 * @param {Function} [callback=identity] The function called per iteration.
 * @param {*} [accumulator] Initial value of the accumulator.
 * @param {*} [thisArg] The `this` binding of `callback`.
 * @returns {*} Returns the accumulated value.
 * @example
 *
 * var sum = _.reduce([1, 2, 3], function(sum, num***REMOVED*** {
 *   return sum + num;
 * }***REMOVED***;
 * // => 6
 *
 * var mapped = _.reduce({ 'a': 1, 'b': 2, 'c': 3 }, function(result, num, key***REMOVED*** {
 *   result[key] = num * 3;
 *   return result;
 * }, {}***REMOVED***;
 * // => { 'a': 3, 'b': 6, 'c': 9 }
 */
function reduce(collection, callback, accumulator, thisArg***REMOVED*** {
  var noaccum = arguments.length < 3;
  callback = createCallback(callback, thisArg, 4***REMOVED***;

  if (isArray(collection***REMOVED******REMOVED*** {
    var index = -1,
        length = collection.length;

    if (noaccum***REMOVED*** {
      accumulator = collection[++index];
  ***REMOVED***
    while (++index < length***REMOVED*** {
      accumulator = callback(accumulator, collection[index], index, collection***REMOVED***;
  ***REMOVED***
***REMOVED*** else {
    baseEach(collection, function(value, index, collection***REMOVED*** {
      accumulator = noaccum
        ? (noaccum = false, value***REMOVED***
        : callback(accumulator, value, index, collection***REMOVED***
  ***REMOVED******REMOVED***;
***REMOVED***
  return accumulator;
}

module.exports = reduce;
